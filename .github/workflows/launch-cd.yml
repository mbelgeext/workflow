name: Launch-cd

on:
  workflow_call:
    inputs:
      AZURE_PROJECT_URL:
        required: true
        type: string 
      AZURE_PIPELINE_NAME:
        required: true
        type: string
      RELEASE_VERSION:
        required: true
        type: string
      APPLICATION_NAME:
        required: true
        type: string
      PROFILE_ENV:
        required: true
        type: string
      IMAGE_NAME:
        required: true
        type: string
      GITHUB_ENVIRONMENT:
        required: false
        type: string
        default: "development"
    secrets:
      AZURE_PIPELINE_TOKEN:
        required: true

jobs:
  launch-cd:
    runs-on: ubuntu-latest
    environment: GITHUB_ENVIRONMENT    
    permissions:
      actions: read
      contents: read
      security-events: write
    strategy:
      fail-fast: true
    name: Launch Azure CD
    steps:

    - name: üõéÔ∏è Checkout
      uses: actions/checkout@v2

    - name: üöÄ Launching CD
      uses: Azure/pipelines@v1.2 
      with:
        azure-devops-project-url: ${{ inputs.AZURE_PROJECT_URL }}
        azure-pipeline-name: ${{ inputs.AZURE_PIPELINE_NAME }}
        azure-devops-token: ${{ secrets.AZURE_PIPELINE_TOKEN }}
        azure-pipeline-variables: '{"image_version": "${{ inputs.RELEASE_VERSION }}", component_name: "${{ inputs.APPLICATION_NAME }}", acr_image: "${{ inputs.IMAGE_NAME }}", environment: "${{ inputs.PROFILE_ENV }}"}'
